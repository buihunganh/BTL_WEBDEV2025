@model List<Product>
@{
    ViewData["Title"] = "Kid";
    var brands = ViewBag.Brands as List<string>;
}

<div class="container-xl py-4 kid-page">
    <h1 class="fw-bold mb-2 text-uppercase">Kid's Shoes</h1>
    <div class="d-md-flex justify-content-between align-items-center mb-4 gap-3">
        <div class="brand-nav-tabs my-2 my-md-0 flex-grow-1" id="brandNavTabsKid">
            <a class="btn btn-outline-primary btn-sm rounded-pill me-2 mb-2" href="#all">All Brands</a>
            @if (brands != null)
            {
                foreach (var b in brands)
                {
                    <a class="btn btn-outline-secondary btn-sm rounded-pill me-2 mb-2" href="#brand-@b.Replace(" ", "-")">@b</a>
                }
            }
        </div>
        <form class="row row-cols-2 row-cols-md-auto g-2 align-items-end filter-bar shadow-sm p-2 rounded bg-white flex-nowrap my-2" autocomplete="off" onsubmit="return false;">
            <div class="col-auto">
                <label class="form-label small text-muted">Min price</label>
                <input type="number" min="0" step="1" class="form-control border-0 bg-light" id="kidMinPrice" style="width:100px;">
            </div>
            <div class="col-auto">
                <label class="form-label small text-muted">Max price</label>
                <input type="number" min="0" step="1" class="form-control border-0 bg-light" id="kidMaxPrice" style="width:100px;">
            </div>
            <div class="col-auto">
                <label class="form-label small text-muted">Brand</label>
                <select class="form-select border-0 bg-light" id="kidBrandSelect">
                    <option value="">All</option>
                    @if (brands != null)
                    {
                        foreach (var b in brands)
                        {
                            <option value="@b">@b</option>
                        }
                    }
                </select>
            </div>
            <div class="col-auto">
                <label class="form-label small text-muted">Sort</label>
                <select class="form-select border-0 bg-light" id="kidSortPrice">
                    <option value="asc">Price ↑</option>
                    <option value="desc">Price ↓</option>
                </select>
            </div>
            <div class="col-auto d-flex gap-1">
                <button type="button" class="btn btn-primary btn-sm px-3" id="kidApplyFilters"><i class="bi bi-funnel"></i> Filter</button>
                <button type="button" class="btn btn-secondary btn-sm px-2" id="kidResetFilters" title="Clear filters"><i class="bi bi-x-lg"></i></button>
            </div>
        </form>
    </div>

    <!-- All products -->
    <section id="all">
        <div class="row g-3" id="kidGrid">
            @foreach (var product in Model)
            {
                var brand = product.Brand?.Name ?? "Others";
                <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4 product-item" data-product-id="@product.Id" data-price="@product.Price" data-brand="@brand" data-name="@product.Name.ToLower()">
                    <div class="card men-card border rounded-4 h-100 bg-white">
                        <div class="d-flex align-items-end justify-content-center men-card-img-wrapper position-relative" style="background:#fff;">
                            @if (!string.IsNullOrEmpty(product.ImageUrl))
                            {
                                <img src="@product.ImageUrl" alt="@product.Name" class="img-fluid card-thumb-img" loading="lazy" />
                            }
                            else
                            {
                                <i class="bi bi-image fs-1 text-secondary"></i>
                            }
                            @if (product.DiscountPrice.HasValue && product.DiscountPrice > 0)
                            {
                                <span class="badge bg-danger position-absolute top-0 end-0 m-2">Sale</span>
                            }
                        </div>
                        <div class="card-body d-flex flex-column align-items-start p-3 pb-2">
                            <span class="badge bg-light border text-dark fw-normal mb-1 px-2 py-1 small">@brand</span>
                            <h5 class="fw-bold mb-1" style="font-size:1.13rem;">@product.Name</h5>
                            <div class="small text-muted mb-2" style="min-height:38px;">@product.Description</div>
                            <div class="mt-auto">
                                @if (product.DiscountPrice.HasValue && product.DiscountPrice > 0)
                                {
                                    <span class="text-danger fw-bold me-2">$@product.DiscountPrice</span>
                                    <span class="text-decoration-line-through small text-muted">$@product.Price</span>
                                }
                                else
                                {
                                    <span class="fw-bold">$@product.Price</span>
                                }
                            </div>
                        </div>
                        <a href="#" class="order-btn" role="button">Order</a>
                    </div>
                 </div>
            }
         </div>
     </section>

    <!-- Per-brand sections -->
    @if (brands != null)
    {
        foreach (var br in brands)
        {
            <section id="brand-@br.Replace(" ", "-")" class="mt-5">
                <h2 class="h4 fw-bold mb-3">@br</h2>
                <div class="row g-3">
                    @foreach (var product in Model.Where(p => p.Brand?.Name == br))
                    {
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4 product-item" data-product-id="@product.Id" data-price="@product.Price" data-brand="@br" data-name="@product.Name.ToLower()">
                            <div class="card men-card border rounded-4 h-100 bg-white">
                                <div class="d-flex align-items-end justify-content-center men-card-img-wrapper position-relative" data-brand="@br">
                                    @if (!string.IsNullOrEmpty(product.ImageUrl))
                                    {
                                        <img src="@product.ImageUrl" alt="@product.Name" class="img-fluid card-thumb-img" loading="lazy" />
                                    }
                                    else
                                    {
                                        <i class="bi bi-image fs-1 text-secondary"></i>
                                    }
                                    @if (product.DiscountPrice.HasValue && product.DiscountPrice > 0)
                                    {
                                        <span class="badge bg-danger position-absolute top-0 end-0 m-2">Sale</span>
                                    }
                                </div>
                                <div class="card-body d-flex flex-column align-items-start p-3 pb-2">
                                    <span class="badge bg-light border text-dark fw-normal mb-1 px-2 py-1 small">@br</span>
                                    <h5 class="fw-bold mb-1" style="font-size:1.13rem;">@product.Name</h5>
                                    <div class="small text-muted mb-2" style="min-height:38px;">@product.Description</div>
                                    <div class="mt-auto">
                                        @if (product.DiscountPrice.HasValue && product.DiscountPrice > 0)
                                        {
                                            <span class="text-danger fw-bold me-2">$@product.DiscountPrice</span>
                                            <span class="text-decoration-line-through small text-muted">$@product.Price</span>
                                        }
                                        else
                                        {
                                            <span class="fw-bold">$@product.Price</span>
                                        }
                                    </div>
                                </div>
                                <a href="#" class="order-btn" role="button">Order</a>
                             </div>
                         </div>
                     }
                 </div>
             </section>
         }
     }
</div>

@section Styles {
<style>
.men-card { border-radius: 16px !important; box-shadow: 0 6px 24px rgba(0,0,0,0.09); min-height:430px; display:flex; flex-direction: column; border: 1.5px solid #E5E5E5;background:#fff; transition: box-shadow .17s,border-color .13s,transform .17s; }
.men-card:hover {box-shadow:0 22px 52px rgba(0,0,0,.15);transform:translateY(-7px) scale(1.034); border-color:#181818;}
.men-card-img-wrapper { min-height:220px; max-height:240px; width:100%; background:#fff; display:flex; align-items:flex-end; justify-content:center; position:relative; padding-top:38px; padding-bottom:12px; border-radius:16px 16px 0 0!important; }
.card-thumb-img { width:auto; max-width:85%; height:90%; object-fit:contain; object-position:center 88%; transition:transform .22s; background:transparent; display:block; margin:0 auto; filter:drop-shadow(0 6px 22px rgba(0,0,0,0.12)); }
.men-card:hover .card-thumb-img {transform:scale(1.08) rotate(-2deg);} .filter-bar {background:#F5F5F5; border:1.3px solid #E5E5E5;} .brand-nav-tabs .btn{transition:background .18s,color .18s;border:1.5px solid #E5E5E5;font-weight:500;color:#232323;background:#fff;} .brand-nav-tabs .btn.active,.brand-nav-tabs .btn:hover{background:#111;color:#fff;border-color:#111;}
</style>
}

@section Scripts {
<script>
(function(){
    document.querySelectorAll('#brandNavTabsKid a').forEach(link=>{
        link.addEventListener('click',function(e){
            const id=this.getAttribute('href');
            const el=document.querySelector(id);
            if(el){e.preventDefault();el.scrollIntoView({behavior:'smooth',block:'start'});}
        });
    });
    // JS filter
    const grid=document.getElementById('kidGrid');
    const items=Array.from(grid.querySelectorAll('.product-item'));
    const minI=document.getElementById('kidMinPrice');
    const maxI=document.getElementById('kidMaxPrice');
    const brandSel=document.getElementById('kidBrandSelect');
    const sortSel=document.getElementById('kidSortPrice');
    const applyBtn=document.getElementById('kidApplyFilters');
    const resetBtn=document.getElementById('kidResetFilters');
    function apply(){
        const minV=parseFloat(minI.value)||null;
        const maxV=parseFloat(maxI.value)||null;
        const brand=brandSel.value;
        items.forEach(el=>{
            const price=parseFloat(el.getAttribute('data-price'));
            const br=el.getAttribute('data-brand');
            let pass=(!minV||price>=minV)&&(!maxV||price<=maxV)&&(!brand||br===brand);
            el.style.display=pass?'':'none';
        });
        let visible=items.filter(e=>e.style.display!=='none');
        visible.sort((a,b)=>{const pa=parseFloat(a.getAttribute('data-price'));const pb=parseFloat(b.getAttribute('data-price'));return sortSel.value==='asc'?pa-pb:pb-pa;});
        visible.forEach(card=>grid.appendChild(card));
    }
    function reset(){minI.value='';maxI.value='';brandSel.value='';sortSel.value='asc';items.forEach(e=>e.style.display='');items.forEach(card=>grid.appendChild(card));}
    applyBtn.addEventListener('click',apply);
    resetBtn.addEventListener('click',reset);
})();
</script>
}


